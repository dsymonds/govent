<html>
	<head>
		<title>{{$.Title}}</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
		<style type="text/css">
			body {
				font-family: Monaco, monospace;
			}
			h1 {
				margin-bottom: 0;
			}
			button {
				clear: right;
				float: right;
				font-size: larger;
			}
			#buffer {
				display: block;
				font-size: larger;
				height: 30em;
				width: 60%;
			}
			#input {
				display: block;
				font-size: larger;
				width: 40%;
			}
			#footer {
				font-size: smaller;
			}
		</style>
	</head>
	<body>

<h1>{{$.Title}}</h1>

<button id="reset" type="button">Reset</button>
<button id="dump-state" type="button">(debug) Dump State</button>

<textarea id="buffer" readonly="readonly">
</textarea>

<input id="input" type="text" />

<div id="footer">
	Powered by <a href="https://developers.google.com/appengine/docs/go/">a horde of gophers</a>.
</div>

<script type="text/javascript">
$(function() {
	$('#input').focus();
	$('#input').keypress(function(event) {
		if (event.which == 13) { // Return
			cmd();
		}
	});
	$('#reset').click(function() {
		if (confirm("Reset game state?")) {
			reset();
		}
	});
	$('#dump-state').click(function() {
		$.get('/dump-state', function(data) {
		       postLine('# ' + data);
		}, "text");
	});

	// Post an empty cmd to start.
	doCmd("");
});

function reset() {
	$.post('/reset', function() {
	       location.reload(true);
	});
}

function cmd() {
	var input = $.trim($('#input').val());
	if (input == "") {
		return;
	}
	$('#input').val('');
	postLine('> ' + input);
	doCmd(input);
}

function doCmd(input) {
	$.post('/cmd', {cmd: input}, function(data) {
		if (data.error) {
			alert(data.error);
		}
		if (data.reply) {
			postLine(data.reply);
		}
		if (data.gameOver) {
			window.setTimeout(function() {
				if (confirm("Game over. Play again?")) {
					reset();
				}
			}, 2000);
		}
	});
}

function postLine(s) {
	var x = $('#buffer').val();
	x = x + s + '\n';
	$('#buffer').val(x);
}
</script>

	</body>
</html>
